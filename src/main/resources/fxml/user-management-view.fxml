<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.geometry.Insets?>

<BorderPane xmlns:fx="http://javafx.com/fxml"
            fx:controller="com.vCampus.view.UserManagementController"
            fx:id="userManagementContainer"
            stylesheets="@../css/main.css">
    
    <!-- 顶部工具栏 -->
    <top>
        <VBox>
            <!-- 角色切换器和用户信息 -->
            <HBox style="-fx-background-color: #e9ecef; -fx-padding: 10;" spacing="10">
                <Label text="当前角色:" style="-fx-font-weight: bold;"/>
                <ComboBox fx:id="roleSwitcher" promptText="选择角色" onAction="#onRoleChanged" style="-fx-min-width: 120;"/>
                <Region HBox.hgrow="ALWAYS"/>
                <Label fx:id="currentUserLabel" style="-fx-font-weight: bold;"/>
                <Button text="刷新" onAction="#onRefresh" style="-fx-background-color: #007bff; -fx-text-fill: white;"/>
            </HBox>
            
            <!-- 搜索和筛选工具栏 -->
            <HBox style="-fx-background-color: #f8f9fa; -fx-padding: 10;" spacing="10">
                <Label text="搜索:"/>
                <TextField fx:id="searchField" promptText="输入姓名、学工号等关键词" style="-fx-min-width: 200;" onAction="#onSearch"/>
                <Button text="搜索" onAction="#onSearch" style="-fx-background-color: #28a745; -fx-text-fill: white;"/>
                
                <Separator orientation="VERTICAL"/>
                
                <Label text="角色筛选:"/>
                <ComboBox fx:id="roleFilter" promptText="所有角色" onAction="#onFilterChanged" style="-fx-min-width: 120;">
                    <items>
                        <FXCollections fx:factory="observableArrayList">
                            <String fx:value="所有角色"/>
                            <String fx:value="学生"/>
                            <String fx:value="教师"/>
                            <String fx:value="管理员"/>
                        </FXCollections>
                    </items>
                </ComboBox>
                
                <Label text="部门筛选:"/>
                <ComboBox fx:id="departmentFilter" promptText="所有部门" onAction="#onFilterChanged" style="-fx-min-width: 120;"/>
                
                <Label text="班级筛选:"/>
                <ComboBox fx:id="classFilter" promptText="所有班级" onAction="#onFilterChanged" style="-fx-min-width: 120;"/>
                
                <Region HBox.hgrow="ALWAYS"/>
                
                <Button text="清除筛选" onAction="#onClearFilters" style="-fx-background-color: #6c757d; -fx-text-fill: white;"/>
            </HBox>
        </VBox>
    </top>
    
    <!-- 左侧操作面板 -->
    <left>
        <VBox spacing="10" style="-fx-background-color: #f8f9fa; -fx-padding: 15; -fx-min-width: 200;">
            <Label text="操作面板" style="-fx-font-weight: bold; -fx-font-size: 14;"/>
            <Separator/>
            
            <Button text="添加用户" onAction="#onAddUser" style="-fx-min-width: 150; -fx-background-color: #007bff; -fx-text-fill: white;"/>
            <Button text="批量导入" onAction="#onBatchImport" style="-fx-min-width: 150; -fx-background-color: #28a745; -fx-text-fill: white;"/>
            <Button text="导出数据" onAction="#onExportData" style="-fx-min-width: 150; -fx-background-color: #17a2b8; -fx-text-fill: white;"/>
            
            <Separator/>
            
            <Button text="批量分配角色" onAction="#onBatchAssignRoles" style="-fx-min-width: 150; -fx-background-color: #ffc107; -fx-text-fill: black;"/>
            <Button text="批量删除" onAction="#onBatchDelete" style="-fx-min-width: 150; -fx-background-color: #dc3545; -fx-text-fill: white;"/>
            
            <Region VBox.vgrow="ALWAYS"/>
            
            <Label text="统计信息" style="-fx-font-weight: bold; -fx-font-size: 12;"/>
            <Label fx:id="totalUsersLabel" text="总用户数: 0"/>
            <Label fx:id="studentCountLabel" text="学生: 0"/>
            <Label fx:id="teacherCountLabel" text="教师: 0"/>
            <Label fx:id="adminCountLabel" text="管理员: 0"/>
        </VBox>
    </left>
    
    <!-- 中心内容区域 -->
    <center>
        <VBox>
            <!-- 用户列表表格 -->
            <TableView fx:id="userTable" style="-fx-min-height: 400;">
                <columns>
                    <TableColumn fx:id="selectColumn" text="选择" style="-fx-min-width: 50; -fx-max-width: 50;">
                        <cellValueFactory>
                            <PropertyValueFactory property="selected"/>
                        </cellValueFactory>
                        <cellFactory>
                            <CheckBoxTableCell fx:factory="forTableColumn"/>
                        </cellFactory>
                    </TableColumn>
                    
                    <TableColumn fx:id="userIdColumn" text="用户ID" style="-fx-min-width: 80;">
                        <cellValueFactory>
                            <PropertyValueFactory property="userId"/>
                        </cellValueFactory>
                    </TableColumn>
                    
                    <TableColumn fx:id="usernameColumn" text="用户名" style="-fx-min-width: 120;">
                        <cellValueFactory>
                            <PropertyValueFactory property="username"/>
                        </cellValueFactory>
                    </TableColumn>
                    
                    <TableColumn fx:id="nameColumn" text="姓名" style="-fx-min-width: 120;">
                        <cellValueFactory>
                            <PropertyValueFactory property="displayName"/>
                        </cellValueFactory>
                    </TableColumn>
                    
                    <TableColumn fx:id="rolesColumn" text="角色" style="-fx-min-width: 150;">
                        <cellValueFactory>
                            <PropertyValueFactory property="rolesDisplay"/>
                        </cellValueFactory>
                    </TableColumn>
                    
                    <TableColumn fx:id="departmentColumn" text="部门/班级" style="-fx-min-width: 120;">
                        <cellValueFactory>
                            <PropertyValueFactory property="departmentClass"/>
                        </cellValueFactory>
                    </TableColumn>
                    
                    <TableColumn fx:id="statusColumn" text="状态" style="-fx-min-width: 80;">
                        <cellValueFactory>
                            <PropertyValueFactory property="status"/>
                        </cellValueFactory>
                    </TableColumn>
                    
                    <TableColumn fx:id="actionsColumn" text="操作" style="-fx-min-width: 150;">
                        <cellValueFactory>
                            <PropertyValueFactory property="actions"/>
                        </cellValueFactory>
                        <cellFactory>
                            <ButtonTableCell fx:factory="forTableColumn"/>
                        </cellFactory>
                    </TableColumn>
                </columns>
            </TableView>
            
            <!-- 分页控件 -->
            <HBox style="-fx-padding: 10;" spacing="10">
                <Button text="上一页" onAction="#onPreviousPage" fx:id="prevPageBtn"/>
                <Label fx:id="pageInfoLabel" text="第 1 页，共 1 页"/>
                <Button text="下一页" onAction="#onNextPage" fx:id="nextPageBtn"/>
                <Region HBox.hgrow="ALWAYS"/>
                <Label text="每页显示:"/>
                <ComboBox fx:id="pageSizeCombo" style="-fx-min-width: 80;">
                    <items>
                        <FXCollections fx:factory="observableArrayList">
                            <String fx:value="10"/>
                            <String fx:value="20"/>
                            <String fx:value="50"/>
                            <String fx:value="100"/>
                        </FXCollections>
                    </items>
                </ComboBox>
            </HBox>
        </VBox>
    </center>
    
    <!-- 底部状态栏 -->
    <bottom>
        <HBox style="-fx-background-color: #f0f0f0; -fx-padding: 5;" spacing="10">
            <Label fx:id="statusLabel" text="就绪"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Label fx:id="selectedCountLabel" text="已选择: 0 个用户"/>
        </HBox>
    </bottom>
    
</BorderPane>
